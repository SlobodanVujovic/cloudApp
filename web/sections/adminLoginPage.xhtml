<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <body>
        <!-- TODO Namestiti da radi refresh.-->
        <ui:composition template="./../templates/masterTemplate.xhtml">
            <ui:define name="left">
                <h:form id="leftForm">
                    <!-- Logout and Company Informations button -->
                    <div class="col-md-4">
                        <h:commandLink value="Company Informations " onclick="return showCompanyInformation()" styleClass="btn btn-warning"><span class="glyphicon glyphicon-info-sign"/></h:commandLink>
                        <!-- TODO Ovaj logout ne valja, treba da postoji terminacija sesije.-->
                        <h:commandLink value="Logout " action="#{navigationController.goHome()}" styleClass="btn btn-warning"><span class="glyphicon glyphicon-log-out"/></h:commandLink>
                    </div>
                </h:form>
            </ui:define>
            <ui:define name="content">
                <div id="adminLoginContainer" class="container">
                    <h1>
                        All company data
                    </h1>

                    <!-- Svi podaci o firmi (uneti prilikom kreiranja naloga).-->
                    <div id="companyInformations">
                        <h:form prependId="false">
                            <p:panelGrid id="companyInformationsGrid" columns="2">

                                <!-- Podaci iz companies DB tabele.-->
                                <h:outputLabel value="Company" class="col-md-4 control-label"/>
                                <h:dataTable value="#{logInController.company}" var="company">
                                    <h:column>
                                        <f:facet name="header">Name</f:facet>
                                        <h:inputText id="companyName" value="#{company.companyName}" required="true" requiredMessage="Company name is required." maxlength="70" >
                                            <f:ajax event="blur" render="companyNameMessage"/>
                                            <f:attribute name="message" value="Company Name can not be empty."/>
                                            <f:validator validatorId="EmptyInputValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="companyNameMessage" class="label label-danger" for="companyName"/>
                                        </div>
                                    </h:column>
                                </h:dataTable>

                                <!-- Podaci iz company_activities DB tabele.-->
                                <h:outputLabel value="Company" class="col-md-4 control-label"/>
                                <h:dataTable id="companyActivityTable" value="#{logInController.setOfCompanyActivities}" var="companyActivity">
                                    <h:column>
                                        <f:facet name="header">Activity</f:facet>
                                            #{companyActivity.getActivityId().getActivity()}
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header"></f:facet>
                                        <!-- Render atribut ima vrednost ID-a panelGroup/Grid-a, koji okruzuje tabelu, ili ID same tabele, proveriti koja opcija funkcionise.--> 
                                        <h:commandLink value="Delete " action="#{logInController.deleteCompanyActivity(companyActivity)}" onclick="return companyMustHaveAtLeastOneActivity()" styleClass="btn btn-warning"><span class="glyphicon glyphicon-remove-circle"/>
                                            <f:ajax render="companyInformationsGrid"/>
                                        </h:commandLink>
                                    </h:column>
                                </h:dataTable>

                                <!-- Button za dodavanje novog activity-a kompanije, h:outputLabel sluzi samo da bi popunili 1. celiju p:panelGrid-a.-->
                                <h:outputLabel value=""/>
                                <h:commandLink value="Add new activity " onclick="showActivityPopupWin(); return false;" styleClass="btn btn-warning"><span class="glyphicon glyphicon-user"/></h:commandLink>

                                <!-- Podaci iz companys_location DB tabele.-->
                                <h:outputLabel value="Location" class="col-md-4 control-label"/>
                                <h:dataTable value="#{logInController.companysLocation}" var="companysLocation">
                                    <h:column>
                                        <f:facet name="header">Address</f:facet>
                                        <h:inputText value="#{companysLocation.address}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">City</f:facet>
                                        <h:inputText value="#{companysLocation.city}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">ZIP code</f:facet>
                                        <h:inputText value="#{companysLocation.zipCode}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">State</f:facet>
                                        <h:inputText value="#{companysLocation.state}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                </h:dataTable>

                                <!-- Podaci iz companys_contacts DB tabele.-->
                                <h:outputLabel value="Contacts" class="col-md-4 control-label"/>
                                <h:dataTable value="#{logInController.companysContact}" var="companysContact">
                                    <h:column>
                                        <f:facet name="header">Phone</f:facet>
                                        <h:inputText value="#{companysContact.phone}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Email</f:facet>
                                        <h:inputText id="companyEmail" value="#{companysContact.email}" required="true" requiredMessage="E-Mail is required.">
                                            <f:ajax event="blur" render="companyEmailMessage"/>
                                            <f:validator validatorId="EmailValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="companyEmailMessage" class="label label-danger" for="companyEmail" />
                                        </div>
                                    </h:column>
                                </h:dataTable>

                                <!-- Podaci iz owners DB tabele.-->
                                <h:outputLabel value="Owner" class="col-md-4 control-label"/>
                                <h:dataTable value="#{logInController.owner}" var="owner">
                                    <h:column>
                                        <f:facet name="header">First Name</f:facet>
                                        <h:inputText id="firstName" value="#{owner.firstName}" required="true" requiredMessage="First name is required." maxlength="70">
                                            <f:ajax event="blur" render="firstNameMessage"/>
                                            <f:attribute name="message" value="First name can not be empty."/>
                                            <f:validator validatorId="EmptyInputValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="firstNameMessage" class="label label-danger" for="firstName" />
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Last Name</f:facet>
                                        <h:inputText id="lastName" value="#{owner.lastName}" required="true" requiredMessage="Last name is required." maxlength="70">
                                            <f:ajax event="blur" render="lastNameMessage"/>
                                            <f:attribute name="message" value="Last name can not be empty."/>
                                            <f:validator validatorId="EmptyInputValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="lastNameMessage" class="label label-danger" for="lastName"/>
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Username</f:facet>
                                        <h:inputText id="adminUserName" value="#{owner.username}" required="true" requiredMessage="Username is required." maxlength="70">
                                            <f:ajax event="blur" render="adminUserNameMessage"/>
                                            <f:attribute name="message" value="Username can not be empty."/>
                                            <f:validator validatorId="EmptyInputValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="adminUserNameMessage" class="label label-danger" for="adminUserName"/>
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Password</f:facet>
                                        <h:inputText id="adminPassword" value="#{owner.password}" required="true" requiredMessage="Password is required." maxlength="50">
                                            <f:ajax event="blur" render="adminPasswordMessage"/>
                                            <f:attribute name="message" value="Invalid Password."/>
                                            <f:validator validatorId="EmptyInputValidator"/>
                                            <f:validator validatorId="ShortPasswordValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="adminPasswordMessage" class="label label-danger" for="adminPassword"/>
                                        </div>
                                    </h:column>
                                </h:dataTable>

                                <!-- Podaci iz owners_contacts DB tabele.-->
                                <h:outputLabel value="Owner Contacts" class="col-md-4 control-label"/>
                                <h:dataTable value="#{logInController.ownersContacts}" var="ownerContact">
                                    <h:column>
                                        <f:facet name="header">Phone</f:facet>
                                        <h:inputText value="#{ownerContact.phone}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Email</f:facet>
                                        <h:inputText id="adminEmail" value="#{ownerContact.email}" required="true" requiredMessage="E-Mail is required.">
                                            <f:ajax event="blur" render="adminEmailMessage"/>
                                            <f:validator validatorId="EmailValidator"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="adminEmailMessage" class="label label-danger" for="adminEmail"/>
                                        </div>
                                    </h:column>
                                </h:dataTable>

                                <!-- Podaci iz agents DB tabele.-->
                                <h:outputLabel value="Agents" class="col-md-4 control-label"/>
                                <h:dataTable id="agentsTable" value="#{logInController.agents}" var="agent">
                                    <h:column>
                                        <f:facet name="header">First Name</f:facet>
                                        <h:inputText id="agentFirstName" value="#{agent.firstName}" required="true" requiredMessage="First Name is required.">
                                            <f:ajax event="blur" render="agentFirstNameMessage"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="agentFirstNameMessage" for="agentFirstName" class="label label-danger"/>
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Last Name</f:facet>
                                        <h:inputText id="agentLastName" value="#{agent.lastName}" required="true" requiredMessage="Last Name is required.">
                                            <f:ajax event="blur" render="agentLastNameMessage"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="agentLastNameMessage" for="agentLastName" class="label label-danger"/>
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Phone</f:facet>
                                        <h:inputText value="#{agent.phone}">
                                            <f:ajax event="change"/>
                                        </h:inputText>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Email</f:facet>
                                        <h:inputText id="agentEmail" value="#{agent.email}" required="true" requiredMessage="Email is required.">
                                            <f:ajax event="blur" render="agentEmailMessage"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="agentEmailMessage" for="agentEmail" class="label label-danger"/>
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header"></f:facet>
                                        <!-- Render atribut ima vrednost ID-a panelGroup/Grid-a, koji okruzuje tabelu, ili ID same tabele, proveriti koja opcija funkcionise. -->
                                        <h:commandLink value="Delete " action="#{logInController.agentOutOfService(agent)}" styleClass="btn btn-warning"><span class="glyphicon glyphicon-remove-circle"/>
                                            <!-- Posto u agentOutOfService() metodu brisemo agenta i iz liste padajuceg menija clientOrders tabele onda je potrebno renderovati i tabelu.-->
                                            <f:ajax render="companyInformationsGrid :clientOrdersForm:clientOrdersTableId"/>
                                        </h:commandLink>
                                    </h:column>
                                </h:dataTable>

                                <!-- Button za dodavanje novog agenta, h:outputLabel sluzi samo da bi popunili 1. celiju p:panelGrid-a.-->
                                <h:outputLabel value=""/>
                                <h:commandLink value="Add new agent " onclick="showAgentsPopupWin(); return false;" styleClass="btn btn-warning"><span class="glyphicon glyphicon-user"/></h:commandLink>

                                <!-- Podaci iz company_order DB tabele.-->
                                <h:outputLabel value="Company orders" class="col-md-4 control-label"/>
                                <h:dataTable id="companyOrdersTable" value="#{logInController.companyOrders}" var="order" border="1">
                                    <h:column>
                                        <f:facet name="header">Creation date</f:facet>
                                            #{order.dateCreated}
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Amount</f:facet>
                                            #{order.amount}
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">URL</f:facet>
                                            #{order.url}
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Reminder [h]</f:facet>
                                        <h:inputText id="reminder" value="#{order.notification}" size="1" title="Valid values are from 1 to 24. If you enter 0, reminder will not be sent."
                                                     required="true" requiredMessage="Valid values are 1 - 24. If you enter 0, reminder will not be sent." validatorMessage="Valid values are 1 - 24. If you enter 0, reminder will not be sent.">
                                            <f:validateLongRange minimum="0" maximum="24"/>
                                            <f:ajax event="blur" render="reminderMessage"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="reminderMessage" for="reminder" class="label label-danger"/>
                                        </div>
                                    </h:column>
                                </h:dataTable>

                                <!-- Podaci iz services DB tabele.-->
                                <h:outputLabel value="Services" class="col-md-4 control-label"/>
                                <h:dataTable id="servicesTable" value="#{logInController.services}" var="service">
                                    <h:column>
                                        <f:facet name="header">Name</f:facet>
                                        <h:inputText id="serviceName" value="#{service.name}" required="true" requiredMessage="Name is required.">
                                            <f:ajax event="blur" render="serviceNameMessage"/>
                                        </h:inputText>
                                        <div>
                                            <h:message id="serviceNameMessage" for="serviceName" class="label label-danger"/>
                                        </div>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header">Reservation</f:facet>
                                        <h:selectBooleanCheckbox value="#{service.reservation}">
                                            <f:ajax event="change"/>
                                        </h:selectBooleanCheckbox>
                                    </h:column>
                                    <h:column>
                                        <f:facet name="header"></f:facet>
                                        <div styleClass="form-group col-md-4 deleteButtonForm">
                                            <h:commandLink value="Delete " action="#{logInController.unavailableService(service)}" styleClass="btn btn-warning"><span class="glyphicon glyphicon-remove-circle"/>
                                                <f:ajax render="companyInformationsGrid:clientOrdersForm:clientOrdersTableId"/>
                                            </h:commandLink>
                                        </div>
                                    </h:column>
                                </h:dataTable>

                                <!-- Button za dodavanje novih servisa, h:outputLabel sluzi samo da bi popunili 1. celiju p:panelGrid-a.-->
                                <h:outputLabel value=""/>
                                <h:commandLink value="Add new service " onclick="showServicePopupWin(); return false;" styleClass="btn btn-warning"><span class="glyphicon glyphicon-tasks"/></h:commandLink>

                                <!-- Button za submit-ovanje cele forme.-->
                                <h:commandLink value="Hide informations " onclick="return hideCompanyInformation()" styleClass="btn btn-warning"><span class="glyphicon glyphicon-info-sign"/></h:commandLink>    
                                <h:commandLink value="Update data " action="#{logInController.updateDatabase()}" styleClass="btn btn-warning"><span class="glyphicon glyphicon-upload"/>
                                    <f:ajax render="companyInformationsGrid"/>
                                </h:commandLink>
                            </p:panelGrid>
                        </h:form>
                    </div>
                    <br/>

                    <!--Podaci iz client_orders tabele.-->
                    <div id="clientOrdersDiv">
                        <h:form id="clientOrdersForm">
                            <!-- Obrati paznju na "rowStyleClass" atribut u p:dataTable tag-u. Ovim atributom definisemo style klasu koju cemo dodeliti nekom redu. Zavisno od
                            vrednosti u EL-u, razlicite klase se dodeljuju razlicitim redovima. U ovom slucaju je 1. dodeljena vrednost promenljivoj "tempRes". Nije potrebno
                            definisati tip promenljive iako je to u ovom slucaju Reservations klasa (sada mozemo koristiti ovu promenljivu bilo gde u ovom EL-u). "tempRes"
                            treba shvatiti kao placeholder a ne kao promenljivu cija je vrednost rezultat izvrsavanje izraza sa desne strane znaka "=". Nakon toga proverimo
                            da li se vrednost razlikuje od null, ako da onda dalje proveravamo da li je vrednost manja od vrednosti trenutnog dana (u long danima od epoch dana).
                            Ako jeste primenimo klasu "pastDays", a ako nije proveravamo da li je vrednost vece od trenutnog dana. Ako jeste koristimo klasu "futureDays". Ako
                            nije onda ne redimo nista jer to znaci da su vrednosti jednake i te redove ostavljamo u default stanju. Ako je vrednost "tempRes" promenljive pak,
                            jednaka null vrednosti, primenjujemo klasu "pastDays".-->
                            <p:dataTable id="clientOrdersTableId" value="#{logInController.listOfClientOrderPresenters}" var="clientOrderPresenter"
                                         filteredValue="#{logInController.filteredClientOrderPresenter}" widgetVar="clientOrdersWidgetVar"
                                         editable="true" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="#{logInController.firstRowToShow},5,10,15" rows="#{logInController.pageRows}" paginatorPosition="bottom" first="#{logInController.firstRowToShow}"
                                         rowStyleClass="#{tempRes = clientOrderPresenter.getReservation(); tempRes != null ? (tempRes.reservationDate.toEpochDay() lt logInController.todayAsLong ? 'pastDays' : (tempRes.reservationDate.toEpochDay() gt logInController.todayAsLong ? 'futureDays' : null )) : 'pastDays'}" 
                                         rowIndexVar="rowIndex">
                                <f:facet name="header">
                                    Client orders
                                    <p:outputPanel id="tableGlobalComponents">
                                        <p:commandButton value="Get orders " action="#{logInController.refreshListOfClientOrderPresenters()}" update="clientOrdersForm:clientOrdersTableId"
                                                         icon="fa fa-pencil" iconPos="right"/>
                                        <h:outputText value="Search all fields:"/>
                                        <p:inputText id="globalFilter" onkeyup="PF('clientOrdersWidgetVar').filter()" onkeypress="preventEnterBehaviour(event)" placeholder="Enter keyword"/>
                                    </p:outputPanel>
                                </f:facet>

                                <p:ajax event="rowEdit" listener="#{logInController.onRowEdit}"/>
                                <p:ajax event="rowEditCancel" listener="#{logInController.onRowCancel}"/>

                                <p:column headerText="ID" sortBy="#{clientOrderPresenter.clientOrder.id}" filterBy="#{clientOrderPresenter.clientOrder.id}" filterMatchMode="contains">
                                    <h:outputText value="#{clientOrderPresenter.clientOrder.id}"/>
                                </p:column>
                                <p:column headerText="Client Name" sortBy="#{clientOrderPresenter.clientOrder.clientName}" filterBy="#{clientOrderPresenter.clientOrder.clientName}" filterMatchMode="contains">
                                    <h:outputText value="#{clientOrderPresenter.clientOrder.clientName}"/>
                                </p:column>

                                <!--Service kolona-->
                                <p:column headerText="Service" sortBy="#{clientOrderPresenter.clientOrder.servicesId.name}" filterBy="#{clientOrderPresenter.clientOrder.servicesId.name}" filterMatchMode="in">
                                    <f:facet name="filter">
                                        <!-- Obrati paznju na atribut "showHeader". Njegova default vrednost je true, kada setujemo false onda se
                                        iskljucuje zaglavlje u kome imamo select all checkbox, search box i cancel dugme. Iskljuceno je jer pravi
                                        problem kada se cekira select all pa se zabroravi da je cekirano a predje se na drugi filtar.-->
                                        <p:selectCheckboxMenu label="" onchange="PF('clientOrdersWidgetVar').filter()" showHeader="false">
                                            <f:selectItems value="#{logInController.servicesNames}"/>
                                        </p:selectCheckboxMenu>
                                    </f:facet>
                                    <h:outputText value="#{clientOrderPresenter.clientOrder.servicesId.name}"/>
                                </p:column>

                                <!--Agent kolona-->
                                <p:column headerText="Agent" sortBy="#{clientOrderPresenter.clientOrder.agentsId.firstName.concat(' ').concat(clientOrderPresenter.clientOrder.agentsId.lastName)}"
                                          filterBy="#{clientOrderPresenter.clientOrder.agentsId.firstName.concat(' ').concat(clientOrderPresenter.clientOrder.agentsId.lastName)}" filterMatchMode="in">
                                    <f:facet name="filter">
                                        <p:selectCheckboxMenu label="" onchange="PF('clientOrdersWidgetVar').filter()" showHeader="false">
                                            <f:selectItems value="#{logInController.agentsNames}"/>
                                        </p:selectCheckboxMenu>
                                    </f:facet>

                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{clientOrderPresenter.clientOrder.agentsId.firstName.concat(' ').concat(clientOrderPresenter.clientOrder.agentsId.lastName)}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <h:selectOneMenu value="#{clientOrderPresenter.clientOrder.agentsId}" converter="omnifaces.SelectItemsConverter" hideNoSelectionOption="true" style="width:100%">
                                                <f:selectItem itemValue="#{null}" itemLabel="Choose agent:" noSelectionOption="true"/>
                                                <f:selectItems value="#{logInController.agents}" var="agent" itemLabel="#{agent.firstName.concat(' ').concat(agent.lastName)}" itemValue="#{agent}"/>
                                            </h:selectOneMenu>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <!--Client Phone kolona-->
                                <p:column headerText="Client Phone" sortBy="#{clientOrderPresenter.clientOrder.clientPhone}" filterBy="#{clientOrderPresenter.clientOrder.clientPhone}" filterMatchMode="contains">
                                    <h:outputText value="#{clientOrderPresenter.clientOrder.clientPhone}"/>
                                </p:column>

                                <!--Client Email kolona-->
                                <p:column headerText="Client Email" sortBy="#{clientOrderPresenter.clientOrder.clientEmail}" filterBy="#{clientOrderPresenter.clientOrder.clientEmail}" filterMatchMode="contains">
                                    <!-- Pravimo link koji, kada kliknemo, otvara prozor za slanje mail-a u default-nom mail klijentu. Da bi se to izvelo potrebno je koristiti
                                        standardnu HTML "mailto: link" sintaksu.-->
                                    <h:outputLink value="mailto:#{clientOrderPresenter.clientOrder.clientEmail}">
                                        <h:outputText value="#{clientOrderPresenter.clientOrder.clientEmail}"/>
                                    </h:outputLink>
                                </p:column>

                                <!--Reservation Date kolona--> 
                                <!--Da bi filtrirali po datumu moramo definisati custom filtre jer dataTable po default-u filtrira samo String-ove. 
                                Potrebno je definisati 2 atributa: "filterBy" koji ima vrednost jednaku onome sto se prikazuje u koloni i "filterFunction"
                                koja definise metod u bean-u koji vrsi filtriranje. Pored toga dodajemo f:facet tag sa "name" atributom koji ima vrednost
                                "filter" i u njemu p:calendar tag koji daje filter vrednost koju koristimo u metodi iz bean-a. AJAX u p:calendar tag-u omogucava
                                edit-ovanje tabele pri promeni vrednosti p:calendar tag-a. Obrati paznju na metod koji se poziva kroz "onkeypress" atribut i na objasnjenje
                                koje postoji za njega kod definicije istog. -->
                                <p:column headerText="Reservation Date" sortBy="#{clientOrderPresenter.reservation.reservationDate}" 
                                          filterBy="#{clientOrderPresenter.reservation.reservationDate}" 
                                          filterFunction="#{logInController.filterByDate}">
                                    <f:facet name="filter">
                                        <p:calendar locale="en_GB" pattern="dd-MM-yyyy" size="10" onkeypress="preventEnterBehaviour(event)">
                                            <p:ajax event="dateSelect" oncomplete="PF('clientOrdersWidgetVar').filter()" update="clientOrdersTableId"/>
                                            <p:ajax event="change" oncomplete="PF('clientOrdersWidgetVar').filter()" update="clientOrdersTableId"/> 
                                        </p:calendar>
                                    </f:facet>
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{clientOrderPresenter.reservation.reservationDate}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:calendar value="#{clientOrderPresenter.reservation.reservationDate}" rendered="#{clientOrderPresenter.reservation != null}" mindate="today" placeholder="Pick new date."
                                                        onkeypress="preventEnterBehaviour(event)" locale="en_GB" pattern="dd-MM-yyyy" size="10"
                                                        class="dateInputInAdminTable">
                                                <p:ajax event="change"/>
                                                <f:converter converterId="localDateConverter"/>
                                            </p:calendar>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <!--Reservation Time kolona-->
                                <p:column headerText="Reservation Time" sortBy="#{clientOrderPresenter.reservation.reservationTime}">
                                    <p:cellEditor>
                                        <f:facet name="output">
                                            <h:outputText value="#{clientOrderPresenter.reservation.reservationTime}"/>
                                        </f:facet>
                                        <f:facet name="input">
                                            <h:inputText id="changeReservationTime" value="#{clientOrderPresenter.reservation.reservationTime}"
                                                         rendered="#{clientOrderPresenter.reservation != null}" onclick="showReservationTimeList();"
                                                         pt:placeholder=" Pick Time" class="adminReservationTime">
                                                <p:ajax event="change"/>
                                            </h:inputText>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column style="width:32px">
                                    <p:rowEditor/>
                                </p:column>

                                <!-- Kolona sa Delete button-om-->
                                <p:column>
                                    <f:facet name="header"></f:facet>
                                    <span class="form-group col-md-4 deleteButtonForm">
                                        <!-- Obrati paznju kako je ubacena ikona u p:commandButton. Koristi se Font Awesome jer Bootstrap ima problema oko
                                        kompatibilnosti sa PrimeFaces-om. Takodje sa "update" atributom radimo ono sto smo radili sa <f:ajax> tag-om. -->
                                        <p:commandButton value="Delete" action="#{logInController.deleteClientOrderPresenterFromTable(clientOrderPresenter)}"
                                                         update="clientOrdersTableId" icon="fa fa-times-circle-o" iconPos="right" 
                                                         onclick="return confirm('Are you sure?')"/>
                                    </span>
                                </p:column>

                            </p:dataTable>
                        </h:form>
                    </div>

                    <!--Popup koji se pojavi kada se dodaje novi agent.-->
                    <div id="agentPopupBack">
                        <div id="agentPopup">
                            <h:form id="agentForm">
                                <h2>Enter your agents</h2>
                                <h:selectOneRadio value="#{agentInput.inputType}">
                                    <f:selectItem itemValue="oneByOne" itemLabel="One by one:"/>
                                    <f:selectItem itemValue="template" itemLabel="By template:"/>
                                    <f:ajax event="change" render="oneByOneForm templateForm"/>
                                </h:selectOneRadio>
                                <h:panelGrid id="oneByOneForm" columns="2" >
                                    <!--Agent First name text input.-->
                                    <h:outputLabel id="agent_first_name_label" value="First Name" class="previewElement"/>
                                    <h:inputText id="agent_first_name" pt:placeholder="Agent's First Name" value="#{logInController.tempAgentForAdding.firstName}" disabled="#{agentInput.inputType != 'oneByOne'}" required="true" requiredMessage="First Name is required.">
                                        <f:ajax event="blur" render="agent_first_name_message"/>
                                    </h:inputText>
                                    <!-- h:inputHidden koristimo samo da bi necim popunili 1. celiju u redu-->
                                    <h:inputHidden/>
                                    <h:message id="agent_first_name_message" for="agent_first_name" class="label label-danger"/>

                                    <!--Agent Last name text input.-->
                                    <h:outputLabel id="agent_last_name_label" value="Last Name" class="previewElement"/>
                                    <h:inputText id="agent_last_name" pt:placeholder="Agents's Last Name" value="#{logInController.tempAgentForAdding.lastName}" disabled="#{agentInput.inputType != 'oneByOne'}" required="true" requiredMessage="Last Name is required.">
                                        <f:ajax event="blur" render="agent_last_name_message"/>
                                    </h:inputText>
                                    <h:inputHidden/>
                                    <h:message id="agent_last_name_message" for="agent_last_name" class="label label-danger"/>

                                    <!--Agent Phone text input.-->
                                    <h:outputLabel id="agent_phone_label" value="Phone #" class="previewElement"/>
                                    <h:inputText id="agent_phone" pt:placeholder="Agent's Phone" value="#{logInController.tempAgentForAdding.phone}" disabled="#{agentInput.inputType != 'oneByOne'}"/>
                                    <h:inputHidden/>
                                    <h:inputHidden/>

                                    <!--Agent Email text input.-->
                                    <h:outputLabel id="agent_email_label" value="E-Mail" class="previewElement"/>
                                    <h:inputText id="agent_email" pt:placeholder="Agent's E-Mail" value="#{logInController.tempAgentForAdding.email}" disabled="#{agentInput.inputType != 'oneByOne'}" required="true" requiredMessage="E-mail is required.">
                                        <f:ajax event="blur" render="agent_email_message"/>
                                        <f:validator validatorId="EmailValidator"/>
                                    </h:inputText>
                                    <h:inputHidden/>
                                    <h:message id="agent_email_message" for="agent_email" class="label label-danger"/>

                                    <!--Button koji upisuje nove agente u listu a zatim i u bazu.-->
                                    <h:commandLink id="agentWriteButton" onclick="return agentInfoValidation()" styleClass="btn btn-warning" disabled="#{agentInput.inputType != 'oneByOne'}" action="#{logInController.addAgent()}">Write <span class="glyphicon glyphicon-ok"></span>
                                        <!-- Pored polja u formi render-ujemo clientOrders tabelu da bi se osvezila lista agenata u padajucem meniju.--> 
                                        <f:ajax render="agent_first_name agent_last_name agent_phone agent_email :clientOrdersForm:clientOrdersTableId" execute="@form"/>
                                    </h:commandLink>
                                </h:panelGrid>

                                <!--Deo koji se tice template upload agenata.-->
                                <p:panelGrid id="templateForm">
                                    <p:row>
                                        <p:column colspan="2">
                                            <ol>
                                                <li>Download MS Office Excel.</li>
                                                <li>Fill it according to it's form and save it.</li>
                                                <li>Upload saved file.</li>
                                            </ol>
                                        </p:column>
                                    </p:row>
                                    <!-- TODO Implementirati akcije DL i UL button-a-->
                                    <p:row id="dlButtonRow">
                                        <p:column>
                                            <h:commandLink id="agentDownloadTemplateButton" class="btn btn-warning" onclick="agentButtonDownload()" disabled="#{agentInput.inputType != 'template'}">Download <span class="glyphicon glyphicon-download-alt"></span></h:commandLink>
                                        </p:column>
                                    </p:row>
                                    <p:row id="ulButtonRow">
                                        <p:column>
                                            <h:commandLink id="agentUploadTemplateButton" class="btn btn-warning" onclick="agentButtonUpload()" disabled="#{agentInput.inputType != 'template'}">Upload <span class="glyphicon glyphicon-cloud-upload"></span></h:commandLink>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>

                                <!-- Ok i Cancle dugmad na dnu popup prozora. Oba dugmeta iskljucuju popup. Ok dugme, pored toga, dodaje novi red
                                u tabelu agenata ali bez ucitavanja cele strane (render-uje se samo tabela). Ako smo upisali neke agente sa "Write"
                                i pritisnuli Cancle, tabela sa agentima se nece render-ovati ali ce se nakon ponovnong ucitavanja stranice, u tabelu 
                                agenata, dodati agenti koji su uneti sa "Write". -->
                                <div align="center">
                                    <h:commandLink id="agentOkButton" action="#{logInController.updateAgents()}" onclick="hidePopupWin('agentPopupBack');" class="btn btn-warning">OK <span class="glyphicon glyphicon-ok"></span>
                                        <f:ajax event="action" execute="@form" render="agentsTable"/>
                                    </h:commandLink>
                                    <h:commandLink id="agentCancleButton" onclick="hidePopupWin('agentPopupBack'); return false;" class="btn btn-warning">Cancel <span class="glyphicon glyphicon-remove-circle"></span></h:commandLink>
                                </div>
                            </h:form>
                        </div>
                    </div>

                    <!--Popup koji se pojavi kada se dodaje novi servis.-->
                    <div id="servicesPopupBack">
                        <div id="servicesPopup">
                            <h:form id="servicesForm">
                                <h2>Enter your services</h2>
                                <p:panelGrid id="servicesOneByOneForm">
                                    <p:row>
                                        <p:column>
                                            <h:outputLabel id="service_name_label" value="Service Name" styleClass="previewElement"/>
                                        </p:column>
                                        <p:column>
                                            <h:inputText id="service_name" pt:placeholder="Enter Service Name" value="#{logInController.tempServiceForAdding.name}" required="true" requiredMessage="Service Name is required.">
                                                <f:ajax event="blur" render="service_name_message"/>
                                            </h:inputText>
                                            <h:inputHidden/>
                                            <div>
                                                <h:message id="service_name_message" for="service_name" class="label label-danger"/>
                                            </div>
                                        </p:column>
                                    </p:row>

                                    <p:row>
                                        <p:column colspan="2">
                                            <h:outputLabel id="service_checkbox_label" value="This service need reservation system" styleClass="previewElement"/>
                                            <h:selectBooleanCheckbox id="service_checkbox" value="#{logInController.tempServiceForAdding.reservation}"/>
                                        </p:column>
                                    </p:row>
                                    <p:row>
                                        <p:column>
                                            <h:outputLabel id="order_name_label" value="Order Name" styleClass="previewElement"/>
                                        </p:column>
                                        <p:column>
                                            <h:selectOneMenu id="orderList" value="#{logInController.tempServiceForAdding.companyOrderId}" converter="omnifaces.SelectItemsConverter">
                                                <f:selectItems value="#{logInController.companyOrders}" var="companyOrders" itemLabel="#{companyOrders.url.substring(51)}" itemValue="#{companyOrders}"/>
                                            </h:selectOneMenu>
                                        </p:column>
                                    </p:row>
                                    <p:row style="text-align: center;">
                                        <p:column colspan="2">
                                            <h:commandLink id="serviceWriteButton" styleClass="btn btn-warning" action="#{logInController.addService()}">Write <span class="glyphicon glyphicon-ok"></span>
                                                <f:ajax render="service_name service_checkbox :clientOrdersForm:clientOrdersTableId" execute="@form"/>
                                            </h:commandLink>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                                <div align="center">
                                    <p:panelGrid>
                                        <p:row>
                                            <p:column>
                                                <h:commandLink id="serviceOkButton" value="OK " styleClass="btn btn-warning" onclick="hidePopupWin('servicesPopupBack');" action="#"><span class="glyphicon glyphicon-ok"></span>
                                                    <f:ajax render="servicesTable"/>
                                                </h:commandLink>
                                            </p:column>
                                            <p:column>
                                                <h:commandLink id="serviceCancleButton" value="Cancel " styleClass="btn btn-warning" onclick="hidePopupWin('servicesPopupBack'); return false;"><span class="glyphicon glyphicon-remove-circle"></span></h:commandLink>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>
                                </div>
                            </h:form>
                        </div>
                    </div>

                    <!--Popup koji se pojavi kada se dodaje novi activity.-->
                    <div id="activityPopupBack">
                        <div id="activityPopup">
                            <h:form id="activityForm">
                                <h4>Choose new company activity</h4>
                                <div class="input-group">
                                    <h:selectOneMenu id="activityList" value="#{logInController.choosenActivity}" converter="omnifaces.SelectItemsConverter">
                                        <f:selectItems value="#{logInController.listOfActivities}" var="activity" itemLabel="#{activity.activity}" itemValue="#{activity}"/>
                                    </h:selectOneMenu>
                                </div>

                                <div align="center">
                                    <h:commandLink id="activityOkButton" action="#{logInController.updateActivity()}" onclick="hidePopupWin('activityPopupBack');" class="btn btn-warning">OK <span class="glyphicon glyphicon-ok"></span>
                                        <f:ajax event="action" execute="@form" render="companyActivityTable"/>
                                    </h:commandLink>
                                    <h:commandLink id="activityCancleButton" onclick="hidePopupWin('activityPopupBack'); return false;" class="btn btn-warning">Cancel <span class="glyphicon glyphicon-remove-circle"></span></h:commandLink>
                                </div>
                            </h:form>
                        </div>
                    </div>

                </div>
            </ui:define>
        </ui:composition>
    </body>
</html>
